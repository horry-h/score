<!--history.wxml-->
<view class="container">
  <view class="common-header">
    <view class="common-header-left" bindtap="goToHome">
      <text class="back-icon">ğŸ </text>
      <text class="back-text">ä¸»é¡µ</text>
    </view>
    <text class="common-header-title">å†å²æˆ¿é—´</text>
    <view class="common-header-right"></view>
  </view>

  <view class="content-section">
    <view class="info-tip">
      <text class="icon">â„¹ï¸</text>
      <text>æŸ¥çœ‹æ‰€æœ‰å†å²æˆ¿é—´çš„æµæ°´å’Œç»“ç®—ä¿¡æ¯</text>
    </view>

    <view wx:if="{{rooms.length > 0}}" class="rooms-container">
      <scroll-view 
        class="rooms-scroll" 
        scroll-y="true" 
        enhanced="true" 
        show-scrollbar="false"
        bindscrolltolower="loadMore"
        lower-threshold="100"
      >
        <view 
          wx:for="{{rooms}}" 
          wx:key="room_id" 
          class="card room-card"
          bindtap="viewRoomDetail"
          data-room="{{item}}"
        >
          <view class="room-header">
            <text class="room-id">æˆ¿é—´å·: {{item.room_id}}</text>
            <text class="status-badge {{item.status === 1 ? 'status-active' : 'status-settled'}}">
              {{item.status === 1 ? 'è¿›è¡Œä¸­' : 'å·²ç»“ç®—'}}
            </text>
          </view>
          <view class="room-info">
            <view class="room-time">
              <text class="icon">ğŸ“…</text>
              <text>{{item.created_at | formatTimestamp}}</text>
            </view>
            <view class="room-score {{item.final_score > 0 ? 'positive' : 'negative'}}">
              <text class="icon">ğŸ’°</text>
              <text>{{item.final_score | formatScore}}åˆ†</text>
            </view>
          </view>
          <view class="room-stats">
            <text class="icon">ğŸ‘¥</text>
            <text>{{item.player_count}}äººå‚ä¸</text>
            <text class="separator">|</text>
            <text class="icon">ğŸ”„</text>
            <text>{{item.transfer_count}}æ¬¡è½¬ç§»</text>
          </view>
        </view>
        
        <!-- åŠ è½½æ›´å¤šæç¤º -->
        <view wx:if="{{hasMore && loading}}" class="loading-more">
          <text class="icon">â³</text>
          <text>åŠ è½½ä¸­...</text>
        </view>
        
        <view wx:elif="{{!hasMore && rooms.length > 0}}" class="no-more">
          <text class="icon">âœ…</text>
          <text>å·²åŠ è½½å…¨éƒ¨æˆ¿é—´</text>
        </view>
      </scroll-view>
    </view>

    <view wx:else class="empty-state">
      <text class="icon">ğŸ“</text>
      <text>æš‚æ— å†å²æˆ¿é—´</text>
    </view>
  </view>
</view>
