<!--room-detail.wxml-->
<view class="container">
  <view class="common-header">
    <view class="common-header-left" bindtap="goToHome">
      <text class="back-icon">ğŸ </text>
      <text class="back-text">è¿”å›ä¸»é¡µ</text>
    </view>
    <text class="common-header-title">æˆ¿é—´è¯¦æƒ…</text>
    <view class="common-header-right"></view>
  </view>

  <view class="room-info">
    <view class="room-header">
      <text class="room-id">æˆ¿é—´å·: {{roomInfo.id}}</text>
      <text class="status-badge {{roomInfo.status === 1 ? 'status-active' : 'status-settled'}}">
        {{roomInfo.status === 1 ? 'è¿›è¡Œä¸­' : 'å·²ç»“ç®—'}}
      </text>
    </view>
    <view class="room-meta">
      <view class="room-time">
        <text class="icon">ğŸ“…</text>
        <text>{{roomInfo.created_at | formatTimestamp}} - {{roomInfo.settled_at | formatTimestamp}}</text>
      </view>
      <view class="room-stats">
        <text class="icon">ğŸ‘¥</text>
        <text>{{players.length}}äººå‚ä¸</text>
        <text class="separator">|</text>
        <text class="icon">ğŸ”„</text>
        <text>{{transfers.length}}æ¬¡è½¬ç§»</text>
        <text class="separator">|</text>
        <text class="icon">â°</text>
        <text>{{gameDuration}}</text>
      </view>
    </view>
  </view>

  <view class="settlement-section">
    <view class="section-title">
      <text class="icon">ğŸ§®</text>
      <text>æœ€ç»ˆç»“ç®—</text>
    </view>
    
    <view wx:for="{{players}}" wx:key="id" class="settlement-item">
      <view class="player-info">
        <view class="player-name">{{item.user.nickname}}</view>
        <view class="player-score-desc">æœ€ç»ˆåˆ†æ•°: {{item.final_score | formatScore}}</view>
      </view>
      <view class="settlement-amount {{item.final_score > 0 ? 'positive' : 'negative'}}">
        {{item.final_score | formatScore}}
      </view>
    </view>
  </view>

  <view class="settlement-section" wx:if="{{settlements.length > 0}}">
    <view class="section-title">
      <text class="icon">ğŸ’°</text>
      <text>è½¬è´¦æ–¹æ¡ˆ</text>
    </view>
    
    <view wx:for="{{settlements}}" wx:key="id" class="settlement-item">
      <view class="transfer-desc">{{item.from_user_name}} â†’ {{item.to_user_name}}</view>
      <view class="settlement-amount">{{item.amount}}åˆ†</view>
    </view>
  </view>

  <view class="history-section">
    <view class="section-title">
      <text class="icon">ğŸ“œ</text>
      <text>å®Œæ•´æµæ°´è®°å½•</text>
    </view>
    
    <view wx:if="{{transfers.length > 0}}">
      <view wx:for="{{transfers}}" wx:key="id" class="history-item">
        <view class="transfer-info">
          <view class="transfer-desc">{{item.from_user_name}} â†’ {{item.to_user_name}}</view>
          <view class="transfer-time">{{item.created_at | formatTimestamp}}</view>
        </view>
        <view class="transfer-amount {{item.amount > 0 ? 'positive' : 'negative'}}">
          {{item.amount | formatScore}}
        </view>
      </view>
    </view>
    <view wx:else class="empty-state">
      <text class="icon">ğŸ“</text>
      <text>æš‚æ— è½¬ç§»è®°å½•</text>
    </view>
  </view>

  <button class="btn" bindtap="backToHistory">
    <text class="icon">â¬…ï¸</text>
    <text>è¿”å›å†å²æˆ¿é—´</text>
  </button>
</view>
